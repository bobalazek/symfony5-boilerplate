{% extends 'contents/settings/_layout.html.twig' %}

{% set image_url = vich_uploader_asset(app.user, 'imageFile') %}

{% block title %}{{ 'Image' | trans }} | {{ parent() }}{% endblock %}

{% block main %}
  <h2>{{ 'Image' | trans }}</h2>
  {{ form_start(form) }}
    <div class="custom-file-wrapper">
      {% if image_url %}
        <div class="text-center">
          {% include 'contents/_shared/user/user_avatar.html.twig' with {
            user: app.user,
            ignore_avatar: true
          } %}
        </div>
        <a class="btn btn-danger btn-sm btn-block mt-3 mb-3 text-center"
          href="{{ url('settings.image', {
            action: 'clear_image_file',
          }) }}">
          {{ 'Clear image' | trans }}
        </a>
        <p class="text-center or-text">{{ 'image.or_select_a_new_one_below' | trans({}, 'settings') }}</p>
      {% else %}
        <img src="" class="img-fluid" />
      {% endif %}
      {{ form_row(form.imageFile) }}
    </div>
    <div>
      <p class="text-center">{{ 'image.or_select_an_existing_avatar_below' | trans({}, 'settings') }}</p>
      <div class="avatars-selector row">
        {% if image_url %}
          <div class="col-md-2 mb-4">
            <div
              class="single-avatar-image {{ app.user.getAvatarImage() == null ? 'selected' : '' }}"
              data-name=""
            >
              <img
                class="img-fluid"
                src="{{ image_url }}"
              />
            </div>
          </div>
        {% endif %}
        {% for avatar_image in avatar_images %}
          <div class="col-md-2 mb-4">
            <div
              class="single-avatar-image {{ app.user.getAvatarImage() == avatar_image ? 'selected' : '' }}"
              data-name="{{ avatar_image }}"
            >
              <img
                class="img-fluid"
                src="{{ url('home') ~ 'assets/images/avatars/' ~ avatar_image }}"
              />
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <button class="btn btn-lg btn-block btn-primary" type="submit">
      {{ 'Save' | trans }}
    </button>
    <div class="d-none">
      {{ form_row(form.avatarImage) }}
    </div>
  {{ form_end(form) }}
{% endblock %}
